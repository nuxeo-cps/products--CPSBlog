<html metal:use-macro="here/content_lib/macros/master">
  <metal:block fill-slot="header">
  </metal:block>

  <metal:block fill-slot="css_slot">
    <link rel="Stylesheet" type="text/css" href=""
      tal:attributes="href string:${base_url}document.css" />
    <link rel="Stylesheet" type="text/css" href=""
      tal:attributes="href string:${base_url}forum.css" />
  </metal:block>

  <metal:block fill-slot="main">
    <tal:block tal:content="structure rendered_main|python:doc.render(proxy=here)" />

    <tal:block define="rel_url python:here.portal_url.getRelativeContentURL(here);
		       items python:here.search(query={'meta_type' : 'BlogEntry'},
                                                sort_by='date',
                                                direction='descending',
						folder_prefix=rel_url)">
      <div tal:repeat="item items">
	<span
	    tal:omit-tag=""
	    tal:define="bentry python:item.getObject().getContent();
			bentry_url python:item.getObject().absolute_url()">
	  <h3>
	    <a href=""
	       tal:attributes="href bentry_url"
	       tal:content="bentry/title" />
	  </h3>
	  <div tal:condition="python:doc.view_mode == 'title_desc' or
			      doc.view_mode == 'full'"
	       tal:content="bentry/description" />
	  <br/>
	  <div tal:condition="python:doc.view_mode == 'full'"
	       tal:content="structure bentry/body">
	  </div>
	  <div>
	    <a href=""
	       tal:attributes="href bentry_url"
	       i18n:translate="blog_entry_comments_label">comments</a>:
	    <span
		tal:omit-tag=""
		tal:content="python:here.getNumberOfComments(item.getObject())" />
	  </div>
	  <form
	      method="post"
	      action=""
	      tal:attributes="action string:${bentry_url}/post_comment">
	    <input type="submit" value="button_add_comment" i18n:attributes="value" />
	  </form>
	  <br/>
	</span>
      </div>
    </tal:block>

    <tal:block tal:condition="python:hasattr(here,'portal_discussion') and
      hasattr(here.portal_discussion, 'isCommentingAllowedFor')">
      <tal:block tal:define="comments_allowed
        python:here.portal_discussion.isCommentingAllowedFor(here);"
        tal:condition="comments_allowed">
        <metal:block
          use-macro="here/forum_comment_lib/macros/view_comments_inline" />
      </tal:block>
    </tal:block>

  </metal:block>

</html>

