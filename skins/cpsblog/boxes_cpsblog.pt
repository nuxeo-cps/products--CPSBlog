<!-- $Id$ -->

<metal:block define-macro="blogcalendarbox_default">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title" i18n:translate=""
                 tal:content="box/box/title">
      box text title
    </metal:block>
    <metal:block fill-slot="box_body">
    <div class="CalendarBox"
         tal:define="DateTime python:modules['DateTime'].DateTime;
                     yearmonth python:here.getMonthAndYear();
                     year python:yearmonth[0];
                     month python:yearmonth[1];
                     location box/box/events_in|nothing;
                     event_types python:box['box'].event_types or [];
                     weeks python:here.portal_calendar.getCPSEventsForCalendar(
                           month=month, year=year, location=location,
                           event_types=event_types);">

      <table cellpadding="0" cellspacing="0" border="0"
        summary="calendar layout">
      <tr><td>
        <table cellpadding="2" cellspacing="0" border="0" class="calendar"
          summary="calendar layout">
          <tr>
            <th>
              <a href="#" class="CalendarArrow"
                 tal:attributes="href python:here.getPreviousMonthLink(
                                             request.URL0, month, year)">
               &#171;
              </a>
            </th>
            <th colspan="5" tal:define="date string:$month/1/$year">
              <span tal:replace="
                  python:cpsmcat('calendar_month_%s' % month)"/>
              <span tal:replace="python:DateTime(date).year()"/>
            </th>
            <th>
              <a href="#" class="CalendarArrow"
                 tal:attributes="href python:here.getNextMonthLink(
                                             request.URL0, month, year)">
               &#187;
              </a>
            </th>
          </tr>
          <tr tal:define="weekdays python:here.portal_calendar.getDayList(here.translation_service)">
            <tal:weekday tal:repeat="weekday weekdays">
              <td class="weekdays" tal:content="python:cpsmcat('calendar_day_%s' % weekday)">Su</td>
            </tal:weekday>
          </tr>
          <tr tal:repeat="week weeks">
            <tal:week tal:define="days week">
              <tal:day tal:repeat="day days">
                <tal:daynumber tal:define="daynumber day/day;
                                           datestring python:'%d/%0.2d/%0.2d' %
                                           (year, month, daynumber);">
                  <tal:block tal:condition="day/event">
                    <td class="event"
                        tal:attributes="class python:here.getDaysClass(
                                        daynumber, month, year, day['event'])">
                      <a href=""
                         tal:attributes="href python:here.getBlogCalCPSDayViewParams(
                                                      context_url=here.getBlogProxy().absolute_url(),
                                                      datestring=datestring,
                                                      location=location,
                                                      event_types=event_types)"
                         tal:content="python: daynumber or default">
                      </a>
                    </td>
                  </tal:block>
                  <tal:block tal:condition="not: day/event">
                    <td tal:content="python: daynumber or default"
                        tal:attributes="class python:here.getDaysClass(
                                        daynumber, month, year)">
                    </td>
                  </tal:block>
                </tal:daynumber>
              </tal:day>
            </tal:week>
          </tr>
        </table>
      </td></tr>
      </table>
    </div>
    </metal:block>
  </metal:block>
</metal:block>


<metal:block define-macro="basebox_blogsearch">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title" i18n:translate=""
                 tal:content="box/box/title">
      box text title
    </metal:block>
    <metal:block fill-slot="box_body">
      <div tal:define="blog_proxy python: here.getBlogProxy()">
        <form method="get" action="blog_search_form" name="searchBoxForm"
              onsubmit="return checkEmptySearch(this)"
              tal:attributes="action python:blog_proxy.absolute_url()+'/blog_search_form'"
              tal:define="sfpo_id string:box">
          <label for="searchGadget"
                 i18n:translate="label_text_to_search">Text to search</label>
          <input id="searchGadget" type="text" name="SearchableText" size="20"
                 value="" tal:attributes="value request/SearchableText|nothing" />
          <input class="context searchButton" type="submit" value="button_search"
                 i18n:attributes="value" /><br />
          <input type="hidden"
                 name="folder_prefix"
                 value=""
                 tal:attributes="value python: utool.getRelativeUrl(blog_proxy)" />
        </form>
      </div>

    </metal:block>
  </metal:block>
</metal:block>


<metal:block define-macro="basebox_blogarchive"
             tal:define="items python:here.getBlogProxy().getBlogArchiveDates()">
  <tal:block condition="items">
    <metal:block use-macro="python:path(box['settings']['box_skin'])">
      <metal:block fill-slot="box_title">
        <metal:block define-slot="box_title">
          <tal:block i18n:translate=""
                     content="box/box/title">box text title</tal:block>
        </metal:block>
      </metal:block>
      <metal:block fill-slot="box_body" tal:define="blog_proxy here/getBlogProxy">
        <ul>
          <li tal:repeat="archive items">
            <a tal:attributes="href string:${blog_proxy/absolute_url}/archive/${archive/year}/${archive/month_mm}">
              <span tal:omit-tag=""
                    i18n:translate=""
                    tal:content="archive/month_name">month</span>
              <span tal:omit-tag="" tal:content="archive/year" />
            </a>
          </li>
        </ul>
      </metal:block>
    </metal:block>
  </tal:block>
</metal:block>


<metal:block define-macro="basebox_blogcategories"
             tal:define="blog_proxy here/getBlogProxy;
                         categories python:here.getCPSBlogCategories(blog_proxy)
                         ">
  <tal:block condition="categories">
    <metal:block use-macro="python:path(box['settings']['box_skin'])">
      <metal:block fill-slot="box_title">
        <metal:block define-slot="box_title">
          <tal:block i18n:translate=""
                     content="box/box/title">box text title</tal:block>
        </metal:block>
      </metal:block>
      <metal:block fill-slot="box_body">
        <ul>
          <li tal:repeat="category categories">
            <tal:block condition="not: category/global">
              <a tal:attributes="href string:${blog_proxy/absolute_url}/archive_view?category=${category/title}&relative=1">
                <span tal:replace="category/title" />&nbsp;(<span tal:replace="category/posts" />)
              </a>
            </tal:block>
            <tal:block condition="category/global">
              <a tal:attributes="href string:${blog_proxy/absolute_url}/archive_view?category=${category/title}">
                <span tal:replace="category/title" />&nbsp;(<span tal:replace="category/posts" />)
              </a>
            </tal:block>
          </li>
        </ul>
      </metal:block>
    </metal:block>
  </tal:block>
</metal:block>
