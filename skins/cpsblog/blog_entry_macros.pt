<!-- $Id$ -->
<tal:block metal:define-macro="blog_entry_listing"
	   tal:condition="items"
	   tal:define="batch python:Batch(items, b_size, int(b_start), orphan=1)">

  <div metal:use-macro="here/batch_navinfo_macros/macros/navinfo" />

  <div tal:repeat="item batch">
    <span tal:omit-tag=""
	  tal:define="bentry item/getContent; bentry_url item/absolute_url">
      <tal:block condition="day_separators|nothing">
	<h4 class="blog"
	    tal:define="be_datetime bentry/created"
	    tal:condition="python: item.getId() in day_separators">
	  <span tal:omit-tag="" i18n:translate="" tal:content="be_datetime/Month">Month</span>
	  <span tal:omit-tag="" tal:content="python: be_datetime.strftime(' %d, %Y')" />
	</h4>
      </tal:block>
      <h5 class="blog">
	<a href=""
	   class="blog"
	   tal:attributes="href bentry_url"
	   tal:content="bentry/title" />
      </h5>
      <div tal:condition="python:doc.view_mode == 'title_desc' or
			  doc.view_mode == 'full'"
	   tal:content="bentry/description" class="row"/>
      <div tal:condition="python:doc.view_mode == 'full'"
	   tal:content="structure bentry/content" class="row" />
      <tal:block define="catstr python:here.getCategoriesString(item);
			 dname python:here.portal_directories.members.getEntry(doc.Creator(), default=None);
			 cname dname/fullname|doc/Creator;
			 email dname/email|nothing;">
	<div class="posted"
	     tal:condition="catstr">
	  <tal:block i18n:translate="">
	    Posted to
	    <span i18n:name="category" tal:content="structure catstr">category</span>
	    by
	    <a href="." title="Here" tal:omit-tag="not:email"
	       class="blog"
	       tal:attributes="href string:mailto:${email}?subject=[${doc/title}]; title email"
	       tal:content="cname" i18n:name="item_creator">Creator</a>
	    @
	    <tal:block
		content="python:here.getDateStr(bentry.modification_date, 'medium')"
		i18n:name="item_modification"/>
	  </tal:block>
	  &nbsp;&nbsp;&nbsp;&nbsp;
	  <span tal:content="python:here.getNumberOfComments(item)" />
	  <span i18n:translate="blog_entry_comments_label"> comments</span>
	  (<a href="" class="blog" tal:attributes="href string:${bentry_url}/post_comment" i18n:translate="">add</a>)
	</div>

	<div class="posted"
	     tal:condition="not: catstr">
	  <tal:block i18n:translate="">
	    Posted by
	    <a href="." title="Here" tal:omit-tag="not:email"
	       class="blog"
	       tal:attributes="href string:mailto:${email}?subject=[${doc/title}]; title email"
	       tal:content="cname" i18n:name="item_creator">Creator</a>
	    @
	    <tal:block
		content="python:here.getDateStr(bentry.modification_date, 'medium')"
		i18n:name="item_modification"/>
	  </tal:block>
	   &nbsp;&nbsp;&nbsp;&nbsp;
	  <span tal:content="python:here.getNumberOfComments(item)" />
	  <span i18n:translate="blog_entry_comments_label"> comments</span>
	  (<a href="" class="blog" tal:attributes="href string:${bentry_url}/post_comment" i18n:translate="">add</a>)
	</div>

      </tal:block>
    </span>
  </div>

  <div metal:use-macro="here/batch_nav_macros/macros/navigation" />

</tal:block>
